<link rel="import" href="../../bower_components/polymer/polymer.html">


<polymer-element name="skill-list" attributes="userSelection">
  <template>
    <!-- build:css skill-list.css -->
    <link rel="stylesheet" type="text/css" href="skill-list.css">
    <!-- endbuild-->

    <core-ajax
      id = "getSkillList"
      auto
      url="http://google.fi"
      params=''
      handleAs="json"
      on-core-response="{{handleResponse}}"
      core-error="{{handleError}}">
    </core-ajax>

    <core-selector selected="0">
    <template repeat="{{skill in skills}}">
      <paper-item title="Select a skill" on-click={{selectSkill}} class="skill" no-padding>
        <div flex >{{ skill.rs.name }}</div>
        <div class="">{{ skill.rs.required_hours - skill.as.allocated_hours }}</div>
      </paper-item>
    </template>
    </core-selector>

  </template>

  <script>
    var skillCombine = function(rs, as) {
      for (var k=0; k<as.length; i++) {
        if (rs.id === as[k].id) {
          return {"rs": rs, "as": as[k]};
        }
      }
      return {"rs": rs, "as": {"name": "", "allocated_hours": 0}};
    };
    (function () {
      Polymer( "skill-list", {
        ready: function() {
          this.skills = [];
          document.addEventListener('load-skill', (function(e) {
            this.skills = [];
            this.skill();
          }).bind(this));
        },
        created: function() {
          // TODO

        },
        skill: function() {
          console.log("jou");
          this.userSelection.phase.required_skills.map(function(rs) {
            console.dir(rs);
            console.log(this);
            this.skills.push(skillCombine(rs, this.userSelection.phase.allocations));
          }.bind(this));
          this.userSelection.selectedSkill = this.skills[0];
        },
        handleResponse: function(event, response) {
          //console.log(response);

        },
        handleError: function(event, response) {
          console.log("Error");
          console.log(response);
        },
        selectSkill: function(event, detail, sender) {
          //console.dir(sender);
          this.userSelection.selectedSkill = sender.templateInstance.model.skill;
        }
      });
    })();
  </script>

</polymer-element>

