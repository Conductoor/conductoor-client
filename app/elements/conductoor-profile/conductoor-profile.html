<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="conductoor-profile" attributes="userSelection project">
  <template>
    <link rel="import" href="../bower_components/paper-item/paper-button.html">
    <link rel="stylesheet" href="conductoor-profile.css">

    <core-ajax
      id ="addEmployeeAjax"
      url="/"
      handleAs="json"
      method="POST"
      contentType="application/json"
      on-core-response="{{handleResponse}}"
      core-error="{{handleError}}">
    </core-ajax>

    <div layout vertical fit class="section profile">
      <div relative class="profile-header">
        <div horizontal layout center>
          <div flex two>
            <div class="profile-img"><img src="../../images/no_image.png"></div>
          </div>
          <div flex three>
            <div class="profile-name">{{userSelection.selectedPerson.name}}</div>
            <div class="profile-title">{{userSelection.selectedPerson.title}}</div>
          </div>
        </div>
      </div>

      <div relative class="profile-main-skill">
        <div horizontal layout center  center-justified>
          <div>Main skill: {{userSelection.selectedPerson.mainSkill}}</div>
        </div>
      </div>

      <div flex one relative class="profile-skills">
        <div horizontal layout >
          <div flex>
            <ul class="skill-list">
              <template repeat="{{ skill in userSelection.selectedPerson.skills }}">
                <li >{{skill}}</li>
              </template>
            </ul>
          </div>
        </div>
      </div>
      <div flex one relative class="profile-add">
        <div horizontal layout center center-justified fit>
          <paper-button raised on-click="{{addEmployee}}">
            <core-icon icon="add"></core-icon>
            Add
          </paper-button>
        </div>
      </div>
    </div>
    <!-- <core-localstorage name="project-backup" value="{{project}}"></core-localstorage>
    <core-localstorage name="userSelectionBackup" value="{{userSelection}}"></core-localstorage> -->
  </template>
  <script>
    (function () {
      Polymer({
        created: function() {
          console.log(this.userSelection);
        },
        addEmployee: function() {
          var ajax = this.$.addEmployeeAjax;
          ajax.body = JSON.stringify(
            {
              "phase_id": "",
              "project_id": "",
              "employee_id": ""
            }
          );
          ajax.go();
          // ADD USER TO LOCAL DATA
          this.storage = document.querySelector("#projectBackup");
          if (this.storage) {
            this.storage.value = this.project;
          }
          this.storageUser = document.querySelector("#userSelectionBackup");
          if (this.storageUser) {
            this.storageUser.value = this.userSelection;
          }
        },
        handleResponse: function() {
          console.log("jooasda");
          //TODO
        },
        handleError: function() {
          console.log("joo2");
          if (this.storage) {
            console.log("joo");
            this.project = this.storage.value;
          }
          if (this.storageUser) {
            this.project = this.storageUser.value;
          }
        }
      });
    })();
  </script>
</polymer-element>
