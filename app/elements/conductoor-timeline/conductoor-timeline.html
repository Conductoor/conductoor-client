<link rel="import" href="../../bower_components/polymer/polymer.html">


<!-- build:js scripts/timesheet.js -->
<script src="../../scripts/timesheet.js"></script>
<!-- endbuild-->
<polymer-element name="conductoor-timeline" attributes="project">
  <template>
    <link rel="stylesheet" href="conductoor-timeline.css">
    <!-- build:css styles/timesheet.css -->
    <link rel="stylesheet" href="../../styles/timesheet.css">
    <!-- endbuild-->

    <div flex class="timeline-panel">
      <div class="timeline-header">
        <h3 on-click=”{{drawBubble}}”>Project timeline</h3>
      </div>

      <div horizontal layout>
        <div flex id="timeline"></div>
      </div>

    </div>
  </template>
  <script>
    var timesheet;
    Polymer({
      // define element prototype here
      ready: function() {
        document.addEventListener('show-timeline', (function(e) {
            if (this.project.phases) {
              console.log(this.getData(this.project));
              timesheet = new Timesheet(this.$.timeline, new Date(this.project.duration.start),
                new Date(this.project.duration.end), this.getData(this.project));
            }
          }).bind(this));
      },
      // TURHIA TÄÄLLÄ?
      // getRandomColor: function() {
      //     var letters = '0123456789ABCDEF'.split('');
      //     var color = '#';
      //     for (var i = 0; i < 6; i++ ) {
      //         color += letters[Math.floor(Math.random() * 16)];
      //     }
      //     return this.changeLuminance(color, -0.4);
      // },
      // changeLuminance: function(hex, lum) {
      //   // validate hex string
      //   hex = String(hex).replace(/[^0-9a-f]/gi, '');
      //   if (hex.length < 6) {
      //     hex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2];
      //   }
      //   lum = lum || 0;

      //   // convert to decimal and change luminosity
      //   var rgb = "#", c, i;
      //   for (i = 0; i < 3; i++) {
      //     c = parseInt(hex.substr(i*2,2), 16);
      //     c = Math.round(Math.min(Math.max(0, c + (c * lum)), 255)).toString(16);
      //     rgb += ("00"+c).substr(c.length);
      //   }
      //   return rgb;
      // },
      getData: function(project) {
        var data = [];
        for (var i=0; i<project.phases.length; i++) {
          data.push(
            [
              new Date(project.phases[i].duration.start),
              new Date(project.phases[i].duration.end),
              project.phases[i].name,
              project.phases[i].color
            ]);
        }
        return data;
      },
      drawBubble: function() {
        console.log(timesheet);
        timesheet.insertData();
      }
    });


  </script>
  <script type="text/javascript">
  </script>
</polymer-element>
