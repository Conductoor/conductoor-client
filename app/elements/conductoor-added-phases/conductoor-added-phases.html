<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="conductoor-added-phases" attributes="editMode projectName phases currentPhase">
  <template>
    <link rel="stylesheet" href="conductoor-added-phases.css">
    <core-menu class="phases-wrapper" selected="">
      <template repeat="{{phase in phases}}">
        <div id="{{phase.color}}" class="phase" relative>
            <paper-item class="phase-header" on-click="{{openPhase}}" target-id="{{phase.color}}">
              <div vertical layout>
                <span class="phase-name">{{phase.name}}</span>
                <!-- TODO -->
                <span class="phase-duration">{{phase.start}} - {{phase.end}}</span>
              </div>
            </paper-item>
            <button layout horizontal center center-justified class="phase-color-code" phase-id="{{phase.color}}" on-click="{{editPhase}}" style="background:#{{phase.color}}"><core-icon icon="create"></core-icon></button>
            <!-- <button layout horizontal center center-justified class="phase-color-code" phase-id="{{phase.color}}" on-click="{{confirmDelete}}" style="background:#{{phase.color}}"><core-icon icon="clear"></core-icon></button> -->
            <div>
              <core-collapse id="phase_content{{phase.color}}" class="phase-content">
                <template repeat="{{skill in phase.skills}}">
                  <paper-item noink class="skill" no-padding>
                    <div flex three class="summary-div">{{skill.name}}</div>
                    <div flex one class="summary-div">{{skill.hours}}</div>
                    <!-- <div title="Required resources {{skill.required_hours}} (work hours)" class="work-hours" style="background:{{phase.color}}">{{skill.required_hours}}</div> -->
                  </paper-item>
                </template>
              </core-collapse>
            </div>
          </div>
      </template>
      <template if="{{!editMode}}">
        <template if="{{phases.length || projectName}}">
          <paper-button id="createProject" raised disabled?="{{!phases.length || !projectName}}" on-click="{{createProject}}">Open Project</paper-button>
        </template>
      </template>

      <template if="{{editMode}}">
        <template if="{{phases.length || projectName}}">
          <paper-button id="updateProject" raised disabled?="{{!phases.length || !projectName}}" on-click="{{updateProject}}">Update Project</paper-button>
        </template>
      </template>

      
    </core-menu>

    <!-- PopUp for delete action-->
    <core-overlay id="modal" layered backdrop transition="core-transition-top">
      <div style="background:#fff;padding:16px;border-radius:8px;">
        <h2>Remove phase</h2>
        <div>Are you sure you want to remove this phase?</div>
        <br>
        <paper-button raised core-overlay-toggle on-click="{{removePhase}}">Remove</paper-button><paper-button raised core-overlay-toggle>Cancel</paper-button>
      </div>
    </core-overlay>

  </template>
  <script>
    (function () {
      Polymer({
        created: function(){
          this.phaseToRemoveId;
        },
        createProject: function(){
          // create only when phases exist
          if (this.phases.length && this.projectName){
            console.log("Created project:");
            console.log("phases: " + JSON.stringify(this.phases) );
            console.log("name: " + this.projectName);
          }
        },
        updateProject: function(){
          // TODO
        },
        openPhase: function(event, detail, sender){
          // show skills
          var phaseId = sender.getAttribute("target-id");  //or phaseColor?
          var querystring = "#phase_content"+phaseId;
          this.shadowRoot.querySelector(querystring).toggle();
        },
        editPhase: function(event, detail, sender){
          var phaseId = sender.getAttribute("phase-id");  //or phaseColor?
          var phaseData = _.findWhere(this.phases, {color:phaseId});
          this.currentPhase = phaseData;
        },
        removePhase: function(){
          this.phases = _.without( this.phases, _.findWhere(this.phases, {color: this.phaseToRemoveId}) );
        },
        confirmDelete: function(event, detail, sender){
          this.phaseToRemoveId = sender.getAttribute("phase-id");
          this.$.modal.toggle();
        }
      });
    })();
  </script>
</polymer-element>
