<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="conductoor-project-listing-page" attributes="">
  <template>
    <link rel="stylesheet" href="conductoor-project-listing-page.css">
    <!-- build:css styles/main.css -->
    <link rel="stylesheet" href="../../styles/main.css">
    <!-- endbuild-->
    <core-ajax
      id = "getProjectList"
      auto
      url="https://conductoor-api.herokuapp.com:443/projects/"
      params=''
      handleAs="json"
      on-core-response="{{handleResponse}}"
      core-error="{{handleError}}">
    </core-ajax>

    <div layout horizontal fit>
      <core-header-panel mode="seamed" id="core_header_panel" flex relative>

        <core-toolbar tool>
        <span flex id="app-name">Conductoor</span>

          <core-menu-button>
            <core-icon-button icon="more-vert"></core-icon-button>
            <core-dropdown halign="right" class="dropdown" layered>
              <core-menu>
                  <paper-item noink><a href="#/project">Current project</a></paper-item>
                  <paper-item noink><a href="#/help">Help</a></paper-item>
                  <paper-item noink><a href="#logout">Logout</a></paper-item>
              </core-menu>
            </core-dropdown>
          </core-menu-button>

        </core-toolbar>

        <div vertical layout fit center class="projects-wrapper">
          <h1>My Projects</h1>
          <div class="projects-list">
            <template repeat="{{project in projects}}">
              <div layout horizontal center class="project">
                <div class="label" flex four>{{project.title}}</div>
                <div class="edit" flex one>
                  <core-icon icon="create"></core-icon>
                  <paper-ripple projectId="{{project.id}}" fit on-click="{{editProject}}"></paper-ripple>
                </div>
              </div>
            </template>
            <div class="new" layout horizontal center-justified>
              <core-icon-button icon="add-circle" on-click="{{newProject}}"></core-icon-button>
            </div>
          </div>
        </div>

      </core-header-panel>
    </div>

  </template>
  <script>
    (function () {
      Polymer({
        // define element prototype here
        created: function(){
          this.projects = this.projects || 
          [
            {id: 1, title: "Project name 1"},
            {id: 1, title: "Project name 2"},
            {id: 1, title: "Project name 3"}
          ]
        },




        handleResponse: function(event, response) {
          //console.log(response.response);
          this.projects = response.response;
          //this.currentProject = this.storage.value;
        },
        handleError: function(event, response) {
          console.log("Error");
          console.log(response);
        },



        editProject: function(event, detail, sender){
          var projectId = sender.getAttribute("projectId");
          window.location.href = "/#/project/edit/"+projectId;
        },
        newProject: function(){
          window.location.href = "/#/project/create";
        }
      });
    })();
  </script>
</polymer-element>
